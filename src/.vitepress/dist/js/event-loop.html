<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript 事件循环（Event Loop） | VitePress</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.DRP289ti.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.HiTNIrny.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.CvuT9hve.js">
    <link rel="modulepreload" href="/assets/chunks/framework.Dh1jimFm.js">
    <link rel="modulepreload" href="/assets/js_event-loop.md.Bgrk_OqW.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-58d98577><!--[--><!--]--><!--[--><span tabindex="-1" data-v-8d33d9b3></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-8d33d9b3>Skip to content</a><!--]--><!----><header class="VPNav" data-v-58d98577 data-v-2b59c8f0><div class="VPNavBar" data-v-2b59c8f0 data-v-8e0d0c8c><div class="wrapper" data-v-8e0d0c8c><div class="container" data-v-8e0d0c8c><div class="title" data-v-8e0d0c8c><div class="VPNavBarTitle" data-v-8e0d0c8c data-v-64968c4c><a class="title" href="/" data-v-64968c4c><!--[--><!--]--><!----><span data-v-64968c4c>VitePress</span><!--[--><!--]--></a></div></div><div class="content" data-v-8e0d0c8c><div class="content-body" data-v-8e0d0c8c><!--[--><!--]--><div class="VPNavBarSearch search" data-v-8e0d0c8c><!----></div><!----><!----><div class="VPNavBarAppearance appearance" data-v-8e0d0c8c data-v-becaaea0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-becaaea0 data-v-df62eb46 data-v-c2b4453c><span class="check" data-v-c2b4453c><span class="icon" data-v-c2b4453c><!--[--><span class="vpi-sun sun" data-v-df62eb46></span><span class="vpi-moon moon" data-v-df62eb46></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-8e0d0c8c data-v-19ac9453 data-v-735371b5><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-735371b5><span class="vpi-more-horizontal icon" data-v-735371b5></span></button><div class="menu" data-v-735371b5><div class="VPMenu" data-v-735371b5 data-v-0afe5424><!----><!--[--><!--[--><!----><div class="group" data-v-19ac9453><div class="item appearance" data-v-19ac9453><p class="label" data-v-19ac9453>Appearance</p><div class="appearance-action" data-v-19ac9453><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-19ac9453 data-v-df62eb46 data-v-c2b4453c><span class="check" data-v-c2b4453c><span class="icon" data-v-c2b4453c><!--[--><span class="vpi-sun sun" data-v-df62eb46></span><span class="vpi-moon moon" data-v-df62eb46></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-8e0d0c8c data-v-f73e20c5><span class="container" data-v-f73e20c5><span class="top" data-v-f73e20c5></span><span class="middle" data-v-f73e20c5></span><span class="bottom" data-v-f73e20c5></span></span></button></div></div></div></div><div class="divider" data-v-8e0d0c8c><div class="divider-line" data-v-8e0d0c8c></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-58d98577 data-v-c73a974a><div class="container" data-v-c73a974a><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-c73a974a data-v-3164e6af><button data-v-3164e6af>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-58d98577 data-v-1969de95><div class="VPDoc has-aside" data-v-1969de95 data-v-6078fcb4><!--[--><!--]--><div class="container" data-v-6078fcb4><div class="aside" data-v-6078fcb4><div class="aside-curtain" data-v-6078fcb4></div><div class="aside-container" data-v-6078fcb4><div class="aside-content" data-v-6078fcb4><div class="VPDocAside" data-v-6078fcb4 data-v-efb5021d><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-efb5021d data-v-8c70827b><div class="content" data-v-8c70827b><div class="outline-marker" data-v-8c70827b></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-8c70827b>On this page</div><ul class="VPDocOutlineItem root" data-v-8c70827b data-v-92aee7a8><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-efb5021d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6078fcb4><div class="content-container" data-v-6078fcb4><!--[--><!--]--><main class="main" data-v-6078fcb4><div style="position:relative;" class="vp-doc _js_event-loop" data-v-6078fcb4><div><h1 id="javascript-事件循环-event-loop" tabindex="-1">JavaScript 事件循环（Event Loop） <a class="header-anchor" href="#javascript-事件循环-event-loop" aria-label="Permalink to &quot;JavaScript 事件循环（Event Loop）&quot;">​</a></h1><h2 id="什么是事件循环" tabindex="-1">什么是事件循环？ <a class="header-anchor" href="#什么是事件循环" aria-label="Permalink to &quot;什么是事件循环？&quot;">​</a></h2><p>事件循环是 JavaScript 实现异步编程的核心机制。它允许 JavaScript 在执行单线程代码的同时，能够处理异步操作，实现非阻塞的 I/O 操作。</p><h2 id="浏览器中的事件循环" tabindex="-1">浏览器中的事件循环 <a class="header-anchor" href="#浏览器中的事件循环" aria-label="Permalink to &quot;浏览器中的事件循环&quot;">​</a></h2><h3 id="基本结构" tabindex="-1">基本结构 <a class="header-anchor" href="#基本结构" aria-label="Permalink to &quot;基本结构&quot;">​</a></h3><p>浏览器的事件循环包含以下主要组件：</p><ol><li><p><strong>调用栈（Call Stack）</strong></p><ul><li>用于存储正在执行的代码</li><li>遵循后进先出（LIFO）原则</li><li>一次只能执行一个任务</li></ul></li><li><p><strong>任务队列（Task Queues）</strong></p><ul><li><strong>宏任务队列（Macro Task Queue）</strong><ul><li>setTimeout/setInterval</li><li>I/O 操作</li><li>UI 渲染</li><li>事件监听</li></ul></li><li><strong>微任务队列（Micro Task Queue）</strong><ul><li>Promise.then/catch/finally</li><li>MutationObserver</li><li>process.nextTick（Node.js 特有）</li></ul></li></ul></li></ol><h3 id="执行顺序" tabindex="-1">执行顺序 <a class="header-anchor" href="#执行顺序" aria-label="Permalink to &quot;执行顺序&quot;">​</a></h3><ol><li>执行同步代码（调用栈）</li><li>检查微任务队列，执行所有微任务</li><li>执行一个宏任务</li><li>重复步骤 2-3</li></ol><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 同步代码</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 宏任务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 微任务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;4&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 同步代码</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 输出顺序：1, 4, 3, 2</span></span></code></pre></div><h2 id="node-js-中的事件循环" tabindex="-1">Node.js 中的事件循环 <a class="header-anchor" href="#node-js-中的事件循环" aria-label="Permalink to &quot;Node.js 中的事件循环&quot;">​</a></h2><h3 id="阶段-phases" tabindex="-1">阶段（Phases） <a class="header-anchor" href="#阶段-phases" aria-label="Permalink to &quot;阶段（Phases）&quot;">​</a></h3><p>Node.js 的事件循环分为六个阶段：</p><ol><li><p><strong>timers 阶段</strong></p><ul><li>执行 setTimeout 和 setInterval 的回调</li></ul></li><li><p><strong>pending callbacks 阶段</strong></p><ul><li>执行一些系统操作的回调（如 TCP 错误）</li></ul></li><li><p><strong>idle, prepare 阶段</strong></p><ul><li>内部使用</li></ul></li><li><p><strong>poll 阶段</strong></p><ul><li>执行 I/O 回调</li><li>检查是否有新的 I/O 事件</li><li>执行 setImmediate 回调</li></ul></li><li><p><strong>check 阶段</strong></p><ul><li>执行 setImmediate 回调</li></ul></li><li><p><strong>close callbacks 阶段</strong></p><ul><li>执行关闭事件的回调（如 socket.on(&#39;close&#39;)）</li></ul></li></ol><h3 id="微任务队列" tabindex="-1">微任务队列 <a class="header-anchor" href="#微任务队列" aria-label="Permalink to &quot;微任务队列&quot;">​</a></h3><p>Node.js 中的微任务队列分为两种：</p><ol><li><p><strong>nextTick 队列</strong></p><ul><li>process.nextTick 的回调</li><li>优先级最高</li></ul></li><li><p><strong>Promise 队列</strong></p><ul><li>Promise 的回调</li><li>优先级次之</li></ul></li></ol><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setImmediate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">process.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nextTick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;4&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;5&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 输出顺序：1, 4, 5, 2, 3</span></span></code></pre></div><h2 id="浏览器与-node-js-的区别" tabindex="-1">浏览器与 Node.js 的区别 <a class="header-anchor" href="#浏览器与-node-js-的区别" aria-label="Permalink to &quot;浏览器与 Node.js 的区别&quot;">​</a></h2><h3 id="_1-任务队列的优先级" tabindex="-1">1. 任务队列的优先级 <a class="header-anchor" href="#_1-任务队列的优先级" aria-label="Permalink to &quot;1. 任务队列的优先级&quot;">​</a></h3><p><strong>浏览器：</strong></p><ul><li>微任务队列优先于宏任务队列</li><li>所有微任务执行完毕后才会执行宏任务</li></ul><p><strong>Node.js：</strong></p><ul><li>微任务队列分为 nextTick 和 Promise 两个队列</li><li>nextTick 队列优先于 Promise 队列</li><li>每个阶段结束后都会检查微任务队列</li></ul><h3 id="_2-定时器实现" tabindex="-1">2. 定时器实现 <a class="header-anchor" href="#_2-定时器实现" aria-label="Permalink to &quot;2. 定时器实现&quot;">​</a></h3><p><strong>浏览器：</strong></p><ul><li>setTimeout 的最小延迟为 4ms</li><li>受页面状态影响（如页面不可见时可能被限制）</li></ul><p><strong>Node.js：</strong></p><ul><li>setTimeout 的延迟更精确</li><li>不受页面状态影响</li><li>提供 setImmediate 作为替代方案</li></ul><h3 id="_3-i-o-处理" tabindex="-1">3. I/O 处理 <a class="header-anchor" href="#_3-i-o-处理" aria-label="Permalink to &quot;3. I/O 处理&quot;">​</a></h3><p><strong>浏览器：</strong></p><ul><li>主要处理 DOM 事件和网络请求</li><li>受同源策略限制</li></ul><p><strong>Node.js：</strong></p><ul><li>处理文件系统、网络、子进程等</li><li>提供更多底层 API</li></ul><h2 id="使用场景和注意事项" tabindex="-1">使用场景和注意事项 <a class="header-anchor" href="#使用场景和注意事项" aria-label="Permalink to &quot;使用场景和注意事项&quot;">​</a></h2><h3 id="浏览器环境" tabindex="-1">浏览器环境 <a class="header-anchor" href="#浏览器环境" aria-label="Permalink to &quot;浏览器环境&quot;">​</a></h3><ol><li><strong>UI 渲染优化</strong></li></ol><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用 requestAnimationFrame 优化动画</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> animate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 更新动画</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    requestAnimationFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(animate);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ol start="2"><li><strong>避免阻塞主线程</strong></li></ol><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用 Web Worker 处理复杂计算</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;worker.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">worker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ data: complexData });</span></span></code></pre></div><ol start="3"><li><strong>事件委托</strong></li></ol><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用事件委托优化事件监听</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">document.body.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;click&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e.target.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">matches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;.button&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 处理按钮点击</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="node-js-环境" tabindex="-1">Node.js 环境 <a class="header-anchor" href="#node-js-环境" aria-label="Permalink to &quot;Node.js 环境&quot;">​</a></h3><ol><li><strong>异步 I/O 操作</strong></li></ol><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用流处理大文件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;large-file.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">readStream.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(writeStream);</span></span></code></pre></div><ol start="2"><li><strong>定时任务处理</strong></li></ol><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用 setImmediate 代替 setTimeout(0)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setImmediate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 在下一个事件循环执行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><ol start="3"><li><strong>错误处理</strong></li></ol><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用 process.nextTick 确保错误处理在同步代码之后</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> apiCall</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    process.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nextTick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 异步操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to &quot;最佳实践&quot;">​</a></h2><ol><li><p><strong>避免阻塞事件循环</strong></p><ul><li>将耗时操作放在 Worker 中</li><li>使用流处理大文件</li><li>避免同步 I/O 操作</li></ul></li><li><p><strong>合理使用微任务</strong></p><ul><li>优先使用 Promise 而不是回调</li><li>谨慎使用 process.nextTick（Node.js）</li><li>避免在微任务中执行耗时操作</li></ul></li><li><p><strong>内存管理</strong></p><ul><li>及时清理定时器</li><li>避免闭包导致的内存泄漏</li><li>使用 WeakMap/WeakSet 存储临时数据</li></ul></li><li><p><strong>错误处理</strong></p><ul><li>使用 try-catch 捕获同步错误</li><li>使用 Promise.catch 处理异步错误</li><li>实现全局错误处理机制</li></ul></li></ol><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>事件循环是 JavaScript 异步编程的核心，理解其工作原理对于编写高性能的应用程序至关重要。浏览器和 Node.js 环境的事件循环实现有所不同，需要根据具体场景选择合适的异步处理方式。通过遵循最佳实践，可以充分利用事件循环的特性，编写出高效、可靠的代码。</p></div></div></main><footer class="VPDocFooter" data-v-6078fcb4 data-v-eb1c115f><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"DAxHluWl\",\"engineer_index.md\":\"BvKpaEOi\",\"index.md\":\"BrtY7fpw\",\"js_closure.md\":\"ZLn0eYDZ\",\"js_cors.md\":\"TSRqBtPH\",\"js_event-loop.md\":\"Bgrk_OqW\",\"js_garbage-collection.md\":\"BqG7mE9f\",\"js_http-cache.md\":\"BKXjSbwO\",\"js_inheritance.md\":\"DPbUph0b\",\"js_prototype.md\":\"BXNa8vMa\",\"js_scope.md\":\"C64af6rC\",\"js_this.md\":\"B0-LWUv8\",\"markdown-examples.md\":\"Cp_VnOaz\",\"mini-program_index.md\":\"CNhF85Ny\",\"node_anti-theft-chain.md\":\"CjATzJiJ\",\"node_http_delete.md\":\"Dvn0KFXu\",\"node_http_get.md\":\"D0Mh4JYr\",\"node_http_post.md\":\"Dsw4KF6X\",\"node_http_put.md\":\"DTjU2VaC\",\"node_index.md\":\"BN-IaXn_\",\"node_ip.md\":\"BRmCh2Xz\",\"node_require.md\":\"DluhnLpe\",\"npm_index.md\":\"CHrolwJH\",\"react_index.md\":\"PpjG48aa\",\"scaffolding_rollup_index.md\":\"D2O7KeQc\",\"scaffolding_vite_index.md\":\"BlA3oRfs\",\"scaffolding_webpack_index.md\":\"_2hFwv7k\",\"test.md\":\"DjcGGHR_\",\"vue_vue3.md\":\"BydDYt3j\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"VitePress\",\"description\":\"A VitePress site\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>